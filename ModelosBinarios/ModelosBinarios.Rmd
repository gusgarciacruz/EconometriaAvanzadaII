---
title: "Modelos de respuesta binaria"
author: Gustavo A. García <br> <span style="font-size:65%" class='notbold'>ggarci24@eafit.edu.co</span> <br> <br> <br> <br> <br> <br> <br> <br> <br>
date: <span style="font-size:65%" class='notbold'>Econometría avanzada II<br> PhD/Maestría en Economía <br> Universidad EAFIT</span>
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
---

```{r setup, include = F}
# This is the recommended set up for flipbooks
# you might think about setting cache to TRUE as you gain practice --- building flipbooks from scratch can be time consuming
options(width = 70)
knitr::opts_chunk$set(
  dev.args = list(bg = 'transparent'),
  fig.width = 12, message = TRUE,
  warning = FALSE, comment = "", cache = TRUE, fig.retina = 3
)
knitr::opts_knit$set(global.par = TRUE)
Sys.setenv(`_R_S3_METHOD_REGISTRATION_NOTE_OVERWRITES_` = "false")
# remotes::install_github("luukvdmeer/sfnetworks")
# remotes::install_github("EvaMaeRey/flipbookr")
# remotes::install_github("rlesur/klippy")
# devtools::install_github("gadenbuie/xaringanExtra")
library(flipbookr)
library(xaringanthemer)
library(tidyverse)
library(klippy)
library(xaringanExtra)
library(gt); library(knitr); library(kableExtra); library(tibble)
library(summarytools)
```

<style>
.notbold{
    font-weight:normal
}

body {
text-align: justify;
}

h1{
      margin-top: -1px;
      margin-bottom: -3px;
}

.small-code pre{
  margin-bottom: -10px;
  
}  

.medium-code pre{
  margin-bottom: 2px;
  
}

</style>

```{r xaringan-scribble, echo=FALSE}
xaringanExtra::use_scribble()
```

```{r xaringanExtra-clipboard, echo=FALSE}
htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "<i class=\"fa fa-clipboard\"></i>",
    success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
    error_text = "<i class=\"fa fa-times-circle\" style=\"color: #F94144\"></i>"
  ),
  rmarkdown::html_dependency_font_awesome()
)
```

```{r xaringan-extra-styles, echo=FALSE}
xaringanExtra::use_extra_styles(
  hover_code_line = TRUE,         #<<
  mute_unhighlighted_code = TRUE  #<<
)
```
<font size = "5">

<br>
<br>
<br>
<br>
<br>

Link slides en formato [html](https://gusgarciacruz.github.io/EconometriaAvanzadaII/ModelosBinarios/ModelosBinarios.html)

Link slides en formato [PDF](https://gusgarciacruz.github.io/EconometriaAvanzadaII/ModelosBinarios/ModelosBinarios.pdf)

---
# <span style="font-size:80%">En este tema</span>

- <span style="font-size:150%">[<span style="color:black">Motivación](#motivacion)</span> <br> <br>

- <span style="font-size:150%">[<span style="color:black">Un ejemplo de modelos binarios: elección del modo de pesca](#ejemplo)</span> <br> <br>

- <span style="font-size:150%">[<span style="color:black">Efectos marginales](#em)</span> <br> <br>

- <span style="font-size:150%">[<span style="color:black">Ejercicio aplicado en R](#r)</span> <br> <br>

---
# <span style="font-size:80%">Lecturas</span>
- <span style="font-size:120%">Cameron, A.C., Fotheringham, A.,  Trivedi, P.K. (2005). *Microeconometrics: Methods and Applications*. Cambridge University Press. <span style="color:red">Cap. 15</span>

---
name: motivacion
# <span style="font-size:80%">Motivación</span>
<font size = "4">

- Los modelos de <span style="color:blue">elección discreta</span> o <span style="color:blue">respuesta cualitativa</span> son modelos que tienen como variable dependiente un indicador entre *m* alternativas mutuamente excluyentes y por lo regular no existe un orden natural de las categorias de la variable dependiente

- El caso más simple de respuesta cualitativa, es el de variable dependiente binaria, es decir, que existe que existe sólo dos resultados $(0$ y $1)$. Algunos ejemplos: 
<p style="margin-bottom:-0.5em">
  - si un individuo está o no empleado
  - si un comprador hace una compra o no
  - si se viaje en transporte público o privado
  
- Resultados binarios son simples de modelar y su estimación usualmente es por máxima verosimilitud, ya que la distribución de los datos es necesariamente definida por el modelo Bernoulli $\Longrightarrow$ si la probabilidad de un resultado es igual a $p$, entonces la probabilidad del otro resultado debe ser $(1-p)$

- Para aplicaciones en regresiones, la probabilidad $p$ variará entre individuos como una función de los regresores

- Los dos modelos estándar de variable dependiente binaria son los modelos <span style="color:blue">logit</span> y <span style="color:blue">probit</span>, los cuales especifican diferentes formas funcionales para las probabilidades como una función de los regresores

---
name: ejem
# <span style="font-size:80%">Ejemplo de un resultado binario: elección del modo de pesca</span>

<font size = "4">

Supongamos que queremos modelar la elección de pescar desde un bote alquilado o desde un muelle. La variable dependiente es binaria con la siguiente estructura:

$$\begin{align*}
y_{i} = 
\begin{cases}
      1 \text{ si se pesca desde un bote privado}   \\
      0 \text{ si se pesca desde un muelle}
\end{cases} 
\end{align*}$$

Asumamos que la única variable explicativa es $ln(relp_i)$, donde $relp$ es el precio de pescar en bote relativo al precio de pescar desde un muelle:

$$ln(relp_i) = ln \left( \frac{precio_{bote,i}}{precio_{muelle,i}} \right)$$

El precio de pescar desde el bote o el muelle varía entre individuos debido a diferentes factores, como por ejemplo, a diferencias en acceso

Se espera que la probabilidad de pescar desde un bote disminuya cuando el precio relativo aumente

---
# <span style="font-size:80%">Ejemplo de un resultado binario: elección del modo de pesca</span>

<font size = "4">

Para estimar esta relación, se tienen las siguientes opciones:
<p style="margin-bottom:-0.5em">

- **OLS**: una regresión por OLS de $y_i$ sobre $ln(relp_i)$. Sin embargo, esta relación lineal ignora:
<p style="margin-bottom:-1em">
  - la forma discreta de la variable dependiente
  - no limita las probabilidades predichas entre $0$ y $1$
  - el efecto de $ln(relp_i)$ sobre la probabilidad es constante sobre toda las distribución de dicha variable

- **Logit**: $$p_i = Pr[y_i = 1 |x_i]=\frac{exp(\beta_1 + \beta_2 x_i)}{1 + exp(\beta_1 + \beta_2 x_i)}$$

- **Probit**: $$p_i = Pr[y_i = 1 |x_i]=\Phi(\beta_1 + \beta_2 x_i)$$
  donde $\Phi$ es la FDA de la normal estándar

Estas funciones no linealies garantizan que:
  <p style="margin-bottom:-1em">
  - $0<p_i <1$
  - el efecto marginal sea diferente sobre la distribución de la variable $x_i$:
  <p style="text-align: center;">
  Logit: $\frac{dp_i}{dx_i}=\frac{exp(\beta_1 + \beta_2 x_i)}{(1 + exp(\beta_1 + \beta_2 x_i))^2}\beta_2$<br><br>
  Probit: $\frac{dp_i}{dx_i}=\phi(\beta_1 + \beta_2 x_i)\beta_2$ 

---
# <span style="font-size:80%">Ejemplo de un resultado binario: elección del modo de pesca</span>

<font size = "4">
```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse); library(summarytools); library(camerondata); library(stargazer)
library(ggview); library(modelsummary); library(gt)

data("fishing")

data <- fishing |> filter(mode %in% c(2,4))|> 
  mutate(mode = case_when(mode==4 ~ 1,
                          mode==2 ~ 0),
         lnrelp = log(pcharter/ppier))

modelos <- list("OLS" = lm(mode ~ lnrelp, data=data),
                "Logit"  = glm(mode ~ lnrelp, data=data, family=binomial(link="logit")),
                "Probit" = glm(mode ~ lnrelp, data=data, family=binomial(link="probit")))
                
modelsummary(modelos, output = 'gt', coef_map = c('lnrelp' = 'ln relp', '(Intercept)' = 'Constante'), stars = c('*'=.1, '**'=.05, '***'=.01), statistic = "std.error", title = 'Tabla 1. Elección del modo de pesca (1=bote; 0=muelle)', gof_omit = 'IC|RMSE|F') |> 
tab_style(style = cell_text(size = "x-small"), locations = cells_source_notes()) |>  tab_source_note(source_note = "Nota: Errores estándar en paréntesis")
```

---
# <span style="font-size:80%">Ejemplo de un resultado binario: elección del modo de pesca</span>

<p style="text-align: center;">
```{r echo=FALSE, message=FALSE, warning=FALSE}

ols <- lm(mode ~ lnrelp, data=data)
data$y_est_ols <- predict(ols)

logit <- glm(mode ~ lnrelp, data=data,
              family=binomial(link="logit"))
data$y_est_logit <- predict(logit, type = "response")

probit <- glm(mode ~ lnrelp, data=data,
              family=binomial(link="probit"))
data$y_est_probit <- predict(probit, type = "response")

ggplot(data) +
  geom_point(aes(x = lnrelp, y = mode, color = "Observado")) +
  geom_line(aes(x = lnrelp, y = y_est_ols, color = "OLS")) +
  geom_line(aes(x = lnrelp, y = y_est_logit, color = "Logit")) +
  geom_line(aes(x = lnrelp, y = y_est_probit, color = "Probit"), linetype = "dashed") +
  scale_color_manual(name = "", 
                     breaks = c("Observado", "OLS", "Logit", "Probit"),
                     values = c("Observado" = "blue", "OLS" = "red", "Logit" = "green", "Probit" = "orange")) +
  labs(title="Gráfico 1. Probabilidades predichas OLS, Logit y Probit",  x = "Ln precio relativo", y = "Probabilidad predicha") +
  theme_gray() +
  theme(legend.position = c(0.9, 0.9), legend.background = element_rect(fill = "transparent")) 
```

---
name: em
# <span style="font-size:80%">Efectos marginales</span>

<font size = "4">

En términos generales el modelo de elección binaria es determinado por:

$$\begin{align*}
y_{i} = 
\begin{cases}
      1 \text{ con probabilidad } p   \\
      0 \text{ con probabilidad } 1-p
\end{cases} 
\end{align*}$$

$$p_i = Pr[y_i=1|\mathbf{x}_i]=F(\mathbf{x}_{i}^{'}\boldsymbol{\beta}),$$
donde $F(\cdot)$ es la función de distribución que puede ser logística (logit) o normal estándar (probit)

El mayor interés en estos modelos es determinar el <span style="color:blue">efecto marginal</span> de cambios en un regresor sobre la porbabilidad condicional que $y=1$. Asumiendo un regresor continuo, el efecto marginal viene determinado por:

$$\frac{\partial Pr[y_i=1|\mathbf{x}_i]}{\partial x_{ij}}=F^{'}(\mathbf{x}_{i}^{'}\boldsymbol{\beta})\beta_j,$$
donde $F^{'}(z) = \partial F(z)/\partial z$

---
# <span style="font-size:80%">Efectos marginales</span>

<font size = "4">

Existen dos tipos de efectos marginales:

<span style="color:blue">Efecto parcial en el promedio</span>
$$\frac{\partial Pr[y_i=1|\mathbf{x}_i]}{\partial x_{ij}}=F^{'}(\overline{\mathbf{x}}_{i}^{'}\hat{\boldsymbol{\beta}})\hat{\beta}_j$$
<span style="color:blue">Efecto parcial promedio</span>

$$\frac{\partial Pr[y_i=1|\mathbf{x}_i]}{\partial x_{ij}}=\left[n^{-1}\sum_{i=1}^n F^{'}(\mathbf{x}_i \hat{\boldsymbol{\beta}})\right]\hat{\beta}_j$$
<span style="color:red">Importante</span>: la interpretación de los efectos marginales se debe dar en término de <span style="color:blue">puntos porcentuales</span> y <span style="color:blue">NO en términos de porcentajes</span>

Por ejemplo, en la probabilidad de empleo, se encuentra un efecto marginal de la educación de 0.03, lo cual indica que un año de educación incrementa la probabilidad de estar empleado en 3 puntos porcentuales   

---
name: r
# <span style="font-size:80%">Ejercicio aplicado en R</span>
<spam style="font-size:110%">

En este ejercicio se va a utilizar la base de datos *fishing* de Cameron y Trivedi (2005), sobre el modo de pesca 

Archivos a descargar:
<p style="margin-bottom:-1em">
- [Descripción de los datos](https://cran.r-project.org/web/packages/camerondata/camerondata.pdf)
- [Código](https://gusgarciacruz.github.io/EconometriaAvanzadaII/ModelosBinarios/L6.R)


